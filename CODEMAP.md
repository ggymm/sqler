## 项目概览
- 名称：`sqler`
- 技术栈：Rust + gpui/gpui-component + 多数据库驱动 crate
- 目标：桌面化多标签数据库管理器，可浏览数据源、维护连接并扩展查询能力

## 代码结构
- `src/main.rs`
  - 程序入口，注册本地资源加载器 `FsAssets`，设置基础主题字号并在 Application 内打开主窗口
  - `init_runtime()` 当前为空实现，预留运行时初始化挂钩
  - 将根视图挂载为 `SqlerApp`
- `src/build/`
  - `mod.rs`：抽象出通用查询构建器，定义 `Operator`/`ConditionValue`/`FilterCondition`/`SortOrder`/`QueryConditions` 以及 `QueryBuilder` trait；`create_builder()` 根据数据库类型返回实现（目前 MySQL/PostgreSQL/SQLite 提供具体实现，其他类型退回 MySQL 语法）
  - `mysql.rs` / `postgres.rs` / `sqlite.rs`：实现对应数据库的 WHERE/ORDER BY/LIMIT 拼接、标识符转义和占位符格式；MySQL/SQLite 使用 `?`，PostgreSQL 使用 `$n`
- `src/app/`
  - `mod.rs`：核心应用状态
    - `SqlerApp` 维护 `TabState` 列表、活动标签、创建窗口句柄以及 `CacheApp`，但数据源仍来自 `seed_sources()` 生成的默认 MySQL 示例
    - 提供标签增删、主题切换、打开新建数据源窗口等交互逻辑
    - `TabState`/`TabView` 管理首页与各数据源工作区的差异化渲染
    - `seed_sources()` 构造带虚拟表列表的 MySQL 演示数据
  - `comps/`
    - `mod.rs`：公共组件工具，封装图标构造、元素 id 拼接工具、对外导出 `DataTable`
    - `table.rs`：`DataTable` 实现 gpui-component 的 `TableDelegate` trait，封装列/行渲染并开启列拖拽、列/行选择等默认配置
  - `create/`
    - `mod.rs`：`CreateWindow` 模态窗口，状态由 `CreateState` 持有；支持在数据源类型选择页与具体表单之间切换，底部操作按钮的“测试连接”仍是占位事件
    - `{mysql,postgres,sqlite,sqlserver,oracle,redis,mongodb}.rs`：各类型表单的输入状态初始化与渲染，主要由 `InputState` 组成（大多提供默认值/placeholder）
  - `workspace/`
    - `mod.rs`：根据 `DataSourceKind` 构造 `WorkspaceState`（MySQL 使用真实工作区，其余复用占位视图）；首页以网格卡片展示所有数据源，双击打开标签
    - `mysql.rs`：带分隔面板的工作区实现，延迟建立 MySQL 会话并通过驱动执行 `SHOW TABLES` 等查询；`create_table_tab` 创建空标签页后直接调用 `reload_table_tab` 加载数据（避免代码重复），`reload_table_tab` 通过 `active_session()` 获取或创建连接，将连接移动到后台线程执行查询，完成后归还连接以实现复用；更新UI时先解构 `TablePage` 结构体为独立变量（columns/rows/total_rows），避免闭包捕获整体导致所有权冲突；表格标签页调用 `build::create_builder()` 拼接 SQL，支持分页刷新、筛选/排序 UI（筛选条件已经收集但 TODO：尚未真正写入 `QueryConditions`，目前仍以分页查询为主）
    - `placeholder.rs`：非 MySQL 数据源的占位展示，提示功能尚未实现
- `src/cache/mod.rs`
  - `CacheApp` 使用 AES-256-GCM 将数据源集合加密写入 `~/.sqler/sources.enc`，初始化时确保目录存在并尝试解密加载
  - 暴露 `sources()` / `sources_mut()` / `sources_update()`，当前未被 UI 调用；错误通过 `CacheError` 枚举描述
- `src/driver/`
  - `mod.rs`：统一驱动接口 `DatabaseDriver`/`DatabaseSession` 以及查询/写入请求响应类型，按数据源类型分发 `check_connection` 与 `create_connection`
  - `mysql.rs`：基于 `mysql` crate 实现连接、查询与写操作，并包含字符集设置及 `mysql::Value` -> JSON 的转换
  - `postgres.rs`：使用 `postgres` crate，禁止 SSL 模式，支持常见类型到 JSON 的映射
  - `sqlite.rs`：使用 `rusqlite`，支持只读/创建模式并将查询结果转换为 JSON
  - `mongodb.rs`：同步客户端封装文档型 CRUD，支持 connection string 或 host 列表配置
  - `redis.rs`：命令式驱动，将响应转换为 JSON，写操作根据返回值估算影响行数
  - `sqlserver.rs`：驱动占位，所有操作返回“未实现”
  - `oracle.rs`：暂无实现内容
- `src/option/`
  - `mod.rs`：定义 `DataSource`、`DataSourceKind`、`DataSourceOptions` 及工具方法（如 `DataSource::tables()`、`display()`），实现 `ConnectionOptions` trait
  - 子模块描述各数据源连接参数结构体并提供脱敏 `display_endpoint()` 输出（如 TLS、schema、read_only 等选项）
- `assets/`：静态资源（数据库图标等），供 UI 引用
- `Cargo.toml`：声明 gpui 相关依赖、AES 加密、serde/serde_json，以及各数据库驱动 crate

## 功能现状
- 主窗口：顶部标签栏 + 主题切换按钮，新建数据源窗口以浮动窗形式打开
- 首页：展示当前数据源卡片（目前仅内置演示 MySQL），双击打开对应工作区标签
- 数据源标签：MySQL 工作区提供表级导航、动态标签页、分页查询与筛选/排序 UI；筛选面板当前只触发分页刷新，尚未真正把条件注入 SQL；其他数据源仍进入占位页
- 查询构建：`build` 模块可为 MySQL/PostgreSQL/SQLite 生成 SELECT/COUNT 语句和参数列表，目前仅被 MySQL 工作区调用
- 新建数据源窗口：支持选择数据库类型并填充表单字段（保留但未保存到缓存，按钮逻辑待接入）
- 缓存系统：`CacheApp` 负责读写本地加密缓存文件，但 `SqlerApp` 尚未把缓存内容注入 UI 或在保存时回写
