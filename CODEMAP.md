## 项目概览
- 名称：`sqler`
- 技术栈：Rust + gpui/gpui-component + SQLx/Tiberius
- 目标：桌面化多标签数据库管理器，可浏览数据源、维护连接并扩展查询能力

## 代码结构
- `src/main.rs`
  - 程序入口，注册资源加载器 `FsAssets`，初始化运行时（包括缓存系统）后打开主窗口，挂载 `SqlerApp`
  - 数据源结构 `DataSource` 使用 `String` 类型的 UUID 作为 `id`，使用 `Option<HashMap<String, Value>>` 类型的 `extras` 字段存储扩展属性（如 tables）
  - `tables()` 方法从 `extras["tables"]` 中提取表名列表
  - `init_runtime()` 初始化 `DataSourceCache`，创建 ~/.sqler 目录
- `src/app/`
  - `mod.rs`：核心应用状态
    - 声明 `SqlerApp`、`TabState` 等 UI 状态及 `NewDataSourceState`
    - 管理窗口生命周期（创建/聚焦"新建数据源"窗口），驱动主题切换、标签增删
    - 主渲染函数将工作区容器设为 `flex_1`，保证底部布局获取满高
    - `open_data_source_tab` 接受 `&str` 类型的 source_id 参数
    - `seed_sources()` 使用 UUID 生成数据源 ID，将 tables 存储在 extras 字段中
  - `workspace/`
    - `mod.rs`：主窗口渲染入口与首页面板，数据源标签分发至各自模块
    - `common.rs`：各数据源工作区共享的侧栏/顶部/配置面板模板
    - `{mysql,postgres,sqlite,sqlserver,oracle,redis,mongodb}.rs`：单一数据源的完整工作区实现（顶部菜单、侧栏、内容区）
  - `create/`
    - `mod.rs`：`CreateDataSourceWindow`，提供类型选择、表单填充和底部操作栏
    - `{postgres,mysql,sqlite,sqlserver}.rs`：各数据库表单状态与渲染
  - `topbar.rs`：标签栏 UI，控制标签切换/关闭、触发新建窗口与主题切换
  - `comps/mod.rs`：通用页面布局（全屏纵向容器等）
- `src/driver/`
  - `mod.rs`：统一驱动接口 `DatabaseDriver`、`DriverError`，以及基于 `DataSourceType` 的 `check_connection` 入口
  - `postgres.rs`：基于 `sqlx::postgres` 的连接校验（支持 SSL 模式）
  - `mysql.rs`：使用 `mysql` crate 建立连接，支持自定义字符集与 TLS
  - `sqlite.rs`：使用 `rusqlite` 检查本地文件并尝试连接，兼容只读模式
  - `sqlserver.rs`：借助 `tiberius` + `tokio-native-tls` 完成 SQL Server 握手，支持 SQL 密码登录
  - `mongodb.rs`：基于 `mongodb::sync::Client` 进行连通性校验（支持 URI 或主机列表）
  - `redis.rs`：使用 `redis` crate 构建连接串，执行 `SELECT`/`PING` 验证连通性
- `src/option/`
  - `mod.rs`：定义 `DataSource` 结构体、`DataSourceKind` 枚举、`DataSourceOptions` 枚举以及 `ConnectionOptions` trait
  - 所有类型均支持 `Serialize`/`Deserialize` 用于持久化
  - `{mysql,postgres,sqlite,sqlserver,oracle,redis,mongodb}.rs`：描述对应数据源的连接参数与默认值
- `src/cache/`
  - `mod.rs`：本地数据源缓存模块
    - `DataSourceCache`：缓存管理器，init 时从 ~/.sqler/sources.enc 加载数据到内存
    - `SerializableDataSource`：中间序列化层，将 `DataSource` 转换为可序列化格式（解决 `SharedString` 不支持 serde 的问题）
    - 使用 AES-256-GCM 加密存储（固定 key）
    - 存储路径：`~/.sqler/sources.enc`
    - 公开接口：`init()` / `save()` / `sources()` / `sources_mut()`
    - 包含完整单元测试：加密/解密、序列化往返、初始化
- `src/export/`：为后续导出功能预留入口
- `assets/`：静态资源（图标等）
- `Cargo.toml`
  - UI 依赖（gpui/gpui-component）+ 数据库驱动依赖（SQLx/Tiberius/ Tokio 等）
  - 新增 uuid、serde/serde_json 依赖用于 UUID 生成和序列化
  - 新增 aes-gcm 依赖用于数据加密
  - 新增 dirs 依赖用于跨平台主目录获取

## 功能现状
- 主窗口：顶部标签栏（首页 / 数据源标签，可关闭 data 标签）、内容区与顶栏操作
- 首页：展示预置数据源卡片，双击可打开详情标签
- "新建数据源"窗口：
  - 顶部标题固定；中部根据状态展示类型卡片或对应表单（支持滚动）
  - 底部操作栏提供"测试连接 / 上一步 / 取消 / 保存"，未选类型时自动禁用相关按钮
- 各数据库表单：按字段分类显示输入框，记忆当前配置状态
- 驱动层：接入 PostgreSQL / MySQL / SQLite / SQL Server 的真实连接测试逻辑，为后续 UI 调用奠定基础

